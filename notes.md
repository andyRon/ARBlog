

https://www.bilibili.com/video/BV1nE411r7TF

2017-10çš„è§†é¢‘

## ä»‹ç»

åšå®¢åŠŸèƒ½

![](images/image-20211009103530416.png)

æŠ€æœ¯ç»„åˆ

åç«¯ï¼šspringboot + JPA + thymeleaf

æ•°æ®åº“ï¼šMySQL

å‰ç«¯UIï¼š[Semantic UI](https://semantic-ui.com/)

å·¥å…·ä¸ç¯å¢ƒ

IDEAã€Maven3ã€JDK8ã€Axure RP 8

```
andyron
111111
```





## 1 éœ€æ±‚ä¸åŠŸèƒ½

### 1.1 ç”¨æˆ·æ•…äº‹

 ç”¨æˆ·æ•…äº‹æ¨¡æ¿ï¼š

ä½œä¸ºä¸€ä¸ªï¼ˆæŸä¸ª**è§’è‰²**ï¼‰ä½¿ç”¨è€…ï¼Œæˆ‘å¯ä»¥åšï¼ˆæŸä¸ª**åŠŸèƒ½**ï¼‰äº‹æƒ…ï¼Œå¦‚æ­¤å¯ä»¥æœ‰ï¼ˆæŸä¸ª**å•†ä¸šä»·å€¼**ï¼‰çš„å¥½å¤„ã€‚

ä¸¾ä¾‹ï¼š

- ä½œä¸ºä¸€ä¸ªæ‹›è˜ç½‘ç«™**æ³¨å†Œç”¨æˆ·**ï¼Œæˆ‘æƒ³**æŸ¥çœ‹æœ€è¿‘3å¤©å‘å¸ƒçš„æ‹›è˜ä¿¡æ¯**ï¼Œä»¥ä¾¿äº**äº†è§£æœ€æ–°çš„æ‹›è˜ä¿¡æ¯**ã€‚



ä¸ªäººåšå®¢ç³»ç»Ÿçš„ç”¨æˆ·æ•…äº‹ï¼š

è§’è‰²ï¼šæ™®é€šè®¿å®¢ï¼Œç®¡ç†å‘˜ï¼ˆæˆ‘ï¼‰



- è®¿å®¢ï¼Œå¯ä»¥åˆ†é¡µæŸ¥çœ‹æ‰€æœ‰çš„åšå®¢
- è®¿å®¢ï¼Œå¯ä»¥å¿«é€ŸæŸ¥çœ‹åšå®¢æ•°æœ€å¤šçš„6ä¸ªåˆ†ç±»
- è®¿å®¢ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„åˆ†ç±»
- è®¿å®¢ï¼Œå¯ä»¥æŸ¥çœ‹æŸä¸ªåˆ†ç±»ä¸‹çš„åšå®¢åˆ—è¡¨
- è®¿å®¢ï¼Œå¯ä»¥å¿«é€ŸæŸ¥çœ‹æ ‡è®°åšå®¢æœ€å¤šçš„10ä¸ªæ ‡ç­¾
- è®¿å®¢ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„æ ‡ç­¾
- è®¿å®¢ï¼Œå¯ä»¥æŸ¥çœ‹æŸä¸ªæ ‡ç­¾ä¸‹çš„åšå®¢åˆ—è¡¨
- è®¿å®¢ï¼Œå¯ä»¥æ ¹æ®å¹´åº¦æ—¶é—´çº¿æŸ¥çœ‹åšå®¢åˆ—è¡¨
- è®¿å®¢ï¼Œå¯ä»¥å¿«é€ŸæŸ¥çœ‹æœ€æ–°çš„æ¨èåšå®¢
- è®¿å®¢ï¼Œå¯ä»¥ç”¨å…³é”®å­—å…¨å±€æœç´¢åšå®¢
- è®¿å®¢ï¼Œå¯ä»¥æŸ¥çœ‹å•ä¸ªåšå®¢å†…å®¹
- è®¿å®¢ï¼Œå¯ä»¥å¯¹åšå®¢å†…å®¹è¿›è¡Œè¯„è®º
- è®¿å®¢ï¼Œå¯ä»¥èµèµåšå®¢å†…å®¹
- è®¿å®¢ï¼Œå¯ä»¥å¾®ä¿¡æ‰«ç é˜…è¯»åšå®¢å†…å®¹
- è®¿å®¢ï¼Œå¯ä»¥åœ¨é¦–é¡µæ‰«æå…¬ä¼—å·äºŒç»´ç å…³æ³¨æˆ‘
- æˆ‘ï¼Œå¯ä»¥ç”¨æˆ·åå’Œå¯†ç ç™»å½•åå°ç®¡ç†
- æˆ‘ï¼Œå¯ä»¥ç®¡ç†åšå®¢
  - æˆ‘ï¼Œå¯ä»¥å‘å¸ƒæ–°åšå®¢
  - æˆ‘ï¼Œå¯ä»¥å¯¹åšå®¢è¿›è¡Œåˆ†ç±»
  - æˆ‘ï¼Œå¯ä»¥å¯¹åšå®¢æ‰“æ ‡ç­¾
  - æˆ‘ï¼Œå¯ä»¥ä¿®æ”¹åšå®¢
  - æˆ‘ï¼Œå¯ä»¥åˆ é™¤åšå®¢
  - æˆ‘ï¼Œå¯ä»¥æ ¹æ®æ ‡é¢˜ï¼Œåˆ†ç±»ï¼Œæ ‡ç­¾æŸ¥è¯¢åšå®¢

- æˆ‘ï¼Œå¯ä»¥ç®¡ç†åšå®¢åˆ†ç±»
  - æˆ‘ï¼Œå¯ä»¥æ–°å¢ä¸€ä¸ªåˆ†ç±»
  - æˆ‘ï¼Œå¯ä»¥ä¿®æ”¹ä¸€ä¸ªåˆ†ç±»
  - æˆ‘ï¼Œå¯ä»¥åˆ é™¤ä¸€ä¸ªåˆ†ç±»
  - æˆ‘ï¼Œå¯ä»¥æ ¹æ®åˆ†ç±»åç§°æŸ¥è¯¢åˆ†ç±»
- æˆ‘ï¼Œå¯ä»¥ç®¡ç†æ ‡ç­¾
  - æˆ‘ï¼Œå¯ä»¥æ–°å¢ä¸€ä¸ªæ ‡ç­¾å·¥
  - æˆ‘ï¼Œå¯ä»¥ä¿®æ”¹ä¸€ä¸ªæ ‡ç­¾
  - æˆ‘ï¼Œå¯ä»¥åˆ é™¤ä¸€ä¸ªæ ‡ç­¾
  - æˆ‘ï¼Œå¯ä»¥æ ¹æ®åç§°æŸ¥è¯¢æ ‡ç­¾

### 1.2 åŠŸèƒ½è§„åˆ’



## 2 é¡µé¢è®¾è®¡ä¸å¼€å‘

### 2.1 è®¾è®¡



### 2.2 é¡µé¢å¼€å‘

ç§»åŠ¨ç«¯é¢„è§ˆè®¾ç½®ï¼š

```html
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

```

`stackable` ç”¨æˆ·æ‰‹æœºé¡µé¢è‡ªé€‚åº”



https://www.toptal.com/designers/subtlepatterns/



### 2.3 æ’ä»¶é›†æˆ

[ç¼–è¾‘å™¨Markdown](https://pandao.github.io/editor.md/)

å†…å®¹æ’ç‰ˆ[typo.css](https://github.com/sofish/typo.css)

åŠ¨ç”»[animate.css]()

ä»£ç é«˜äº®[prism](https://prismjs.com/)

æ»šåŠ¨ä¾¦æµ‹[waypoints](http://imakewebthings.com/waypoints/)

å¹³æ»‘æ»šåŠ¨[jquery.scrollTo](https://github.com/flesler/jquery.scrollTo)

ç›®å½•ç”Ÿæˆ[Tocbot](http://tscanlin.github.io/tocbot/)

äºŒå †ç ç”Ÿæˆ[qrcode.js](http://davidshimjs.github.io/qrcodejs/)



Animate.cssä½¿ç”¨æœ‰é—®é¢˜



## 3 æ¡†æ¶æ­å»º

### 3.1 æ„å»ºä¸é…ç½®

è§†é¢‘ 2017-10 springboot 1.5.7  

> P20 
>
> Jpa è¦æ”¹æˆMyBatis
>
> 22min æ—¥å¿—

#### 1ã€ å¼•å…¥SpringBootä¾èµ–



#### 2ã€**application.yml**é…ç½®

- æ•°æ®åº“é…ç½®
- æ—¥å¿—é…ç½®

é™„åŠ æ—¥å¿—é…ç½® **logback-spring.xml** ğŸ”–P20 20min 



### 3.2 å¼‚å¸¸å¤„ç†

#### 1å®šä¹‰é”™è¯¯é¡µé¢

404

500

error

#### 2 é”™è¯¯æ‹¦æˆª





### 3.3 æ—¥å¿—å¤„ç†

#### 1ã€è®°å½•æ—¥å¿—å†…å®¹

- è¯·æ±‚url
- è®¿é—®è€…ip
- è°ƒç”¨æ–¹æ³•classMethod
- å‚æ•°args
- è¿”å›å†…å®¹



### 3.4 é¡µé¢å¤„ç†

1ã€é™æ€é¡µé¢å¯¼å…¥é¡¹ç›®

2ã€thymeleafå¸ƒå±€

Fragmentå¸ƒå±€

3ã€é”™è¯¯é¡µé¢ç¾åŒ–



## 4ã€è®¾è®¡ä¸è§„èŒƒ

### 4.1 å®ä½“è®¾è®¡

#### å®ä½“ç±»ï¼š

- åšå®¢Blog
- åšå®¢åˆ†ç±»Type
- åšå®¢æ ‡ç­¾Tag
- åšå®¢è¯„è®ºComment
- ç”¨æˆ·User

#### å®ä½“å…³ç³»

![](images/image-20211016161125989.png)

è¯„è®ºç±»è‡ªå…³è”å…³ç³»ï¼š
![](images/image-20211016161353363.png)



Blogç±»ï¼š

![](images/image-20211016161440032.png)



Typeç±»ï¼š

![](images/image-20211016161636396.png)



Tagç±»ï¼š

![](images/image-20211016163335775.png)



Commentç±»ï¼š

![](images/image-20211016161703158.png)

Userç±»ï¼š

![](images/image-20211016161717115.png)



### 4.2 åº”ç”¨åˆ†å±‚

![](images/image-20211016161805671.png)



### 4.3 å‘½åçº¦å®š

Service/DAOå±‚å‘½åçº¦å®šï¼š

- è·å–å•ä¸ªå¯¹è±¡çš„æ–¹æ³•ç”¨getåšå‰ç¼€ã€‚
- è·å–å¤šä¸ªå¯¹è±¡çš„æ–¹æ³•ç”¨liståšå‰ç¼€ã€‚
- è·å–ç»Ÿè®¡å€¼çš„æ–¹æ³•ç”¨countåšå‰ç¼€ã€‚
- æ’å…¥çš„æ–¹æ³•ç”¨save(æ¨è)æˆ–insertåšå‰ç¼€ã€‚
- åˆ é™¤çš„æ–¹æ³•ç”¨remove(æ¨è)æˆ–deleteåšå‰ç¼€ï¼Œ
- ä¿®æ”¹çš„æ–¹æ³•ç”¨updateåšå‰ç¼€ã€‚



> hibernate_sequence



## 5ã€åå°ç®¡ç†

### 5.1 ç™»å½•

1. æ„å»ºç™»å½•é¡µé¢å’Œåå°ç®¡ç†é¦–é¡µ
2. UserServiceå’ŒUserRepository
3. LoginController
4. MD5åŠ å¯†
5. ç™»å½•æ‹¦æˆªå™¨



### 5.2 åˆ†ç±»ç®¡ç†

1. åˆ†ç±»ç®¡ç†é¡µé¢
2. åˆ†ç±»åˆ—è¡¨åˆ†é¡µ



```json
{
  "content": [
    {}
  ],
  "last": false,
  "totalPages": 9,
  "totalElements": 123,
  
  
}
```



3. åˆ†ç±»æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤



```
th:unless å’Œth:ifç›¸å
```



### 5.3 æ ‡ç­¾ç®¡ç†

 

```
@GeneratedValue(strategy = GenerationType.IDENTITY)

IDENTITY    //é‡‡ç”¨æ•°æ®åº“IDè‡ªå¢é•¿çš„æ–¹å¼æ¥è‡ªå¢ä¸»é”®å­—æ®µï¼ŒOracle ä¸æ”¯æŒè¿™ç§æ–¹å¼ï¼› 
AUTO        //JPAè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„ç­–ç•¥ï¼Œæ˜¯é»˜è®¤é€‰é¡¹ï¼› 
SEQUENCE    //é€šè¿‡åºåˆ—äº§ç”Ÿä¸»é”®ï¼Œé€šè¿‡@SequenceGenerator æ³¨è§£æŒ‡å®šåºåˆ—åï¼ŒMySqlä¸æ”¯æŒè¿™ç§æ–¹å¼ 
TABLE       //é€šè¿‡è¡¨äº§ç”Ÿä¸»é”®ï¼Œæ¡†æ¶å€Ÿç”±è¡¨æ¨¡æ‹Ÿåºåˆ—äº§ç”Ÿä¸»é”®ï¼Œä½¿ç”¨è¯¥ç­–ç•¥å¯ä»¥ä½¿åº”ç”¨æ›´æ˜“äºæ•°æ®åº“ç§»æ¤ã€‚
```

> ğŸ”–@GeneratedValueæ— æ³•å®ç°è‡ªå¢ï¼Œ`new Type()`å¾—åˆ°çš„idéƒ½æ˜¯0ï¼Ÿï¼Ÿ



### 5.4 åšå®¢ç®¡ç†

1ã€åšå®¢åˆ†é¡µæŸ¥è¯¢

2ã€åšå®¢æ–°å¢

3ã€åšå®¢ä¿®æ”¹

4ã€åšå®¢åˆ é™¤

ç»§æ‰¿`JpaSpecificationExecutor<Blog> `æ¥å£ï¼Œç”¨æˆ·å¤æ‚æŸ¥è¯¢



åŠ¨æ€çš„å±€éƒ¨åˆ·æ–° 



ğŸ”–P32 35minå¤„çš„è°ƒå¼æ–¹å¼å€¼å¾— å­¦ä¹ 





> P34 22min å¡ä½çš„åŸå› ï¼Œä¸èƒ½æ·»åŠ  idä¸èƒ½è‡ªåŠ¨é€’å¢ï¼Œå¯èƒ½åŸå› ï¼šå¤–é”®ã€mysqlé»˜è®¤å‚æ•°ã€@GeneratedValue ã€‚ã€‚ã€‚



> adminéœ€è¦ä¼˜åŒ–çš„åœ°æ–¹ï¼š p36
>
> - åšå®¢æ–‡ç« æ–°å¢å’Œä¿®æ”¹é¡µé¢ï¼Œæ ‡ç­¾è‡ªå·±æ·»åŠ åŠŸèƒ½
> - æ ‡ç­¾é¡µé¢çš„æ ·å¼å’Œåˆ†é¡µ
> - åšå®¢æ–°å¢æè¿°å­—æ®µ



### å…¨å±€æœç´¢

## 6ã€å‰ç«¯å±•ç¤º



### 6.1 å‰ç«¯åšå®¢å±•ç¤º



1. åšå®¢åˆ—è¡¨

2. topåˆ†ç±»

3. topæ ‡ç­¾

4. æœ€æ–°åšå®¢æ¨è

5. åšå®¢è¯¦æƒ…

Markdownè½¬æ¢ä¸ºHTML

commonmark-java

https://github.com/commonmark/commonmark-java

```xml
<dependency>
    <groupId>org.commonmark</groupId>
    <artifactId>commonmark</artifactId>
    <version>0.18.0</version>
</dependency>

```

åšå®¢è¯¦æƒ…è¯„è®ºåŠŸèƒ½

- è¯„è®ºä¿¡æ¯æäº¤ä¸å›å¤åŠŸèƒ½
- è¯„è®ºä¿¡æ¯åˆ—è¡¨å±•ç¤ºåŠŸèƒ½
- ç®¡ç†å‘˜å›å¤è¯„è®ºåŠŸèƒ½

è¯„è®ºæ˜¯è‡ªå…³è”çš„



```mysql
set foreign_key_checks = 0;
alter table `t_comment` modify column `id` bigint not null  auto_increment first ;  
set foreign_key_checks = 1;
-- å…ˆæ¥è§¦å¤–é”®çš„é™åˆ¶ï¼Œç„¶åå†ä¿®æ”¹ä¸ºè‡ªåŠ¨å¢é•¿
-- å­—æ®µå±æ€§firstè¡¨ç¤ºä½œä¸ºç¬¬ä¸€åˆ—
```

```mysql
 CREATE TABLE `t_comment` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `avatar` varchar(255) DEFAULT NULL,
  `content` varchar(255) DEFAULT NULL,
  `create_time` datetime(6) DEFAULT NULL,
  `email` varchar(255) DEFAULT NULL,
  `nickname` varchar(255) DEFAULT NULL,
  `blog_id` bigint(20) DEFAULT NULL,
  `parent_comment_id` bigint(20) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `FKke3uogd04j4jx316m1p51e05u` (`blog_id`),
  KEY `FK4jj284r3pb7japogvo6h72q95` (`parent_comment_id`),
  CONSTRAINT `FK4jj284r3pb7japogvo6h72q95` FOREIGN KEY (`parent_comment_id`) REFERENCES `t_comment` (`id`),
  CONSTRAINT `FKke3uogd04j4jx316m1p51e05u` FOREIGN KEY (`blog_id`) REFERENCES `t_blog` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci 

CREATE TABLE `t_blog` (
  `id` bigint(20) NOT NULL,
  `title` varchar(255) DEFAULT NULL,
  `appreciation` bit(1) NOT NULL,
  `commentabled` bit(1) NOT NULL,
  `create_time` datetime(6) DEFAULT NULL,
  `first_picture` varchar(255) DEFAULT NULL,
  `flag` varchar(255) DEFAULT NULL,
  `published` bit(1) NOT NULL,
  `recommend` bit(1) NOT NULL,
  `share_statement` bit(1) NOT NULL,
  `description` longtext,
  `content` longtext,
  `update_time` datetime(6) DEFAULT NULL,
  `views` int(11) DEFAULT NULL,
  `type_id` bigint(20) DEFAULT NULL,
  `user_id` bigint(20) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `FK292449gwg5yf7ocdlmswv9w4j` (`type_id`),
  KEY `FK8ky5rrsxh01nkhctmo7d48p82` (`user_id`),
  CONSTRAINT `FK292449gwg5yf7ocdlmswv9w4j` FOREIGN KEY (`type_id`) REFERENCES `t_type` (`id`),
  CONSTRAINT `FK8ky5rrsxh01nkhctmo7d48p82` FOREIGN KEY (`user_id`) REFERENCES `t_user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci
```

ä¿å­˜æ—¶æŠ¥é”™ï¼Œå¤–é”®å½±å“ï¼Œå¯¼è‡´ä¸èƒ½æ·»åŠ æ•°æ®

```bash
2021-11-03 16:37:38.160  INFO 6293 --- [nio-8080-exec-4] com.andyron.arblog.aspect.LogAspect      : Request : {url='http://localhost:8080/comments', ip='0:0:0:0:0:0:0:1', classMethod='com.andyron.arblog.web.CommentController.post', args=[Comment{id=null, nickname='å°æˆ', email='rongming.2008@163.com', content='è¯„è®ºæµ‹è¯•', avatar='null', createTime=null}]}
Hibernate: insert into t_comment (avatar, blog_id, content, create_time, email, nickname, parent_comment_id) values (?, ?, ?, ?, ?, ?, ?)
2021-11-03 16:37:38.186  WARN 6293 --- [nio-8080-exec-4] o.h.engine.jdbc.spi.SqlExceptionHelper   : SQL Error: 1452, SQLState: 23000
2021-11-03 16:37:38.187 ERROR 6293 --- [nio-8080-exec-4] o.h.engine.jdbc.spi.SqlExceptionHelper   : Cannot add or update a child row: a foreign key constraint fails (`arblog`.`t_comment`, CONSTRAINT `FK4jj284r3pb7japogvo6h72q95` FOREIGN KEY (`parent_comment_id`) REFERENCES `t_comment` (`id`))
2021-11-03 16:37:38.256 ERROR 6293 --- [nio-8080-exec-4] c.a.a.h.ControllerExceptionHandler       : Request URL : http://localhost:8080/comments, Exception : could not execute statement; SQL [n/a]; constraint [null]; nested exception is org.hibernate.exception.ConstraintViolationException: could not execute statement
2021-11-03 16:37:38.257  WARN 6293 --- [nio-8080-exec-4] .m.m.a.ExceptionHandlerExceptionResolver : Resolved [org.springframework.dao.DataIntegrityViolationException: could not execute statement; SQL [n/a]; constraint [null]; nested exception is org.hibernate.exception
```



P40

p43



åšå®¢æŒ‰åˆ†ç±»å±•ç¤º



åšå®¢æŒ‰æ ‡ç­¾æŒ‰å±•ç¤º



åšå®¢å½’çº³



å…³äºæˆ‘å±•ç¤ºåŠåŠŸèƒ½å®Œå–„



PqueryP



### 6.2 åˆ†ç±»é¡µ



### 6.3 æ ‡ç­¾é¡µ



### 6.4 å½’æ¡£é¡µ



### 6.5 å…³äºæˆ‘

